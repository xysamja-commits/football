<!-- Upload on the website-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Season Simulation</title>

  <!-- ==== UPDATED CSS ==== -->
<style>
  /* --------------------------------------------------------------
     1Ô∏è‚É£ Base & existing styles
     -------------------------------------------------------------- */
  .container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
  }
  .wrapper {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
  }
  .bookmaker-block {
    flex: 1 1 200px;
    background: #fff;
    padding: 1rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f6f8;
    color: #333;
    padding: 0;
  }
  .main-content {
    max-width: 100vw;
    margin: 0 auto;
    padding: 1rem;
  }
  h2, h3 {
    color: #2c3e50;
    margin-bottom: 10px;
  }
  label {
    display: inline-block;
    margin: 8px 0 4px;
    font-weight: 600;
  }
  input[type="number"] {
    padding: 6px 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 80px;
    margin-right: 10px;
  }
  button {
    background: #3498db;
    color: #fff;
    border: none;
    padding: 10px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 10px;
  }
  button:hover {
    background: #2980b9;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
    background: #fff;
  }
  th {
    background: #ecf0f1;
    font-weight: bold;
  }
  .result {
    background: #fff;
    border-left: 4px solid #3498db;
    padding: 15px;
    margin-top: 20px;
    font-size: 1rem;
    line-height: 1.5;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    white-space: pre-wrap;
  }
  .toggle {
    display: inline-block;
    margin-bottom: 20px;
    font-weight: bold;
  }
  .dark-mode {
    background: #1e1e1e;
    color: #f0f0f0;
  }
  .dark-mode table {
    background: #2c2c2c;
    color: #f0f0f0;
  }
  .dark-mode th {
    background: #3a3a3a;
  }
  .dark-mode .result {
    background: #2c2c2c;
    border-left-color: #00bfff;
  }
  .match-line {
    display: block;
    margin-bottom: 6px;
    font-family: monospace;
  }

  /* --------------------------------------------------------------
     2Ô∏è‚É£ Desktop League-Table ‚Äì sticky first two columns + scroll
     -------------------------------------------------------------- */
  .league-table-wrapper {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin-top: 1rem;
  }
  .league-table {
    border-collapse: collapse;
    width: 100%;
    min-width: max-content;
    table-layout: fixed;
  }
  /* Pos column (col 1) */
  .league-table th:nth-child(1),
  .league-table td:nth-child(1) {
    position: sticky;
    left: 0;
    background: #fff;
    z-index: 3;
    min-width: 30px;
  }
  /* Club column (col 2) */
  .league-table th:nth-child(2),
  .league-table td:nth-child(2) {
    position: sticky;
    left: 30px;
    background: #fff;
    z-index: 2;
    min-width: 80px;
  }

  /* --------------------------------------------------------------
     3Ô∏è‚É£ Mobile-only: collapse to 2 columns under 768px
     -------------------------------------------------------------- */
  @media (max-width: 768px) {
    /* wrapper scroll remains */
    .league-table-wrapper {
      overflow-x: auto;
    }

    /* let table size to content */
    .league-table {
      table-layout: auto;
      width: auto;
      min-width: max-content;
    }

    /* left-align every cell */
    .league-table th,
    .league-table td {
      text-align: left !important;
    }

    /* Col 1: Pos & Club ‚Äì sticky, top layer */
    .league-table th:first-child,
    .league-table td:first-child {
      position: sticky;
      left: 0;
      background: #fff;
      z-index: 3;
      padding: 0.5rem 1rem;
    }

    /* Col 2: Stats ‚Äì scrollable under col1, monospace, no-wrap */
    .league-table th:nth-child(2),
    .league-table td:nth-child(2) {
      display: table-cell;
      position: relative;
      z-index: 1;
      white-space: nowrap;
      font-family: monospace;
      font-variant-numeric: tabular-nums;
      padding: 0.5rem 1rem;
    }

    /* hide any extra columns */
    .league-table th:nth-child(n+3),
    .league-table td:nth-child(n+3) {
      display: none;
    }
  }
  @media (max-width: 768px) {
  /* wrapper scroll */
  .league-table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* let table auto-size to its content */
  .league-table {
    table-layout: auto;
    width: auto;
    min-width: max-content;
  }

  /* left-align everything */
  .league-table th,
  .league-table td {
    text-align: left !important;
  }

  /* Col 1: Pos & Club ‚Äì sticky */
  .league-table th:first-child,
  .league-table td:first-child {
    position: sticky;
    left: 0;
    background: #fff;
    z-index: 2;
    padding: 0.5rem 1rem;
  }

  /* Col 2: Stats ‚Äì never wrap, monospace + tabular-nums */
  .league-table th:nth-child(2),
  .league-table td:nth-child(2) {
    display: table-cell;
    white-space: nowrap;
    font-family: monospace;
    font-variant-numeric: tabular-nums;
    padding: 0.5rem 1rem;
  }

  /* hide any extra columns beyond #2 */
  .league-table th:nth-child(n+3),
  .league-table td:nth-child(n+3) {
    display: none;
  }
}
.marketplace-btn,
.facebook-btn {
  background: #ff6200;
  color: #fff;
}

.marketplace-btn:hover,
.facebook-btn:hover {
  background: #e55a00;
}
.marketplace-btn,
.facebook-btn {
  transition: background 0.3s ease;
}

</style>
</head>
<body>
  <!-- Main container -->
  <div class="main-content">
    <h2>Season Simulation</h2>

    <div class="controls">
      <button id="startBtn">Start Season</button>
      <button id="changeBtn">Change Clubs</button>
      <button id="clearBtn">Clear All</button>
    </div>

    <div id="clubChanger" style="display:none; margin-top:12px;">
      <label for="clubInput">Enter clubs (comma-separated):</label>
      <input type="text" id="clubInput" placeholder="Rijeka,Dinamo,Hajduk, ‚Ä¶" size="50"/>
      <button id="saveClubsBtn">Save Clubs</button>
      <div id="suggestions" style="margin-top:8px; color:#555;"></div>
    </div>

    <div id="recentResults" class="result"></div>

    <button id="nextBtn" disabled style="display:none;">Next Round</button>

    <div id="tableContainer" style="display:none;"></div>

    <div id="archive" class="result"></div>
  </div>
  <div>
<a href="https://www.lfbuyer.com" target="_blank">
  <button class="marketplace-btn">üåê Visit marketplace LF BUYER.COM</button>
</a>

<a href="https://www.facebook.com/rio.lfbuyer/" target="_blank">
  <button class="facebook-btn">üëç Give Us a Like on Facebook</button>
</a>


  <!-- ==== SCRIPT ‚Äì ONLY THE THREE MODIFIED FUNCTIONS ==== -->
<script>
/* ==============================================================
   1Ô∏è‚É£ INPUT SANITIZER ‚Äì blocks any SQL‚Äëlike syntax
   ============================================================== */
const sqlBlacklist = [
  /select\s+/i, /insert\s+/i, /update\s+/i, /delete\s+/i,
  /drop\s+/i, /create\s+/i, /alter\s+/i, /truncate\s+/i,
  /grant\s+/i, /revoke\s+/i, /union\s+/i, /exec\s+/i,
  /execute\s+/i, /declare\s+/i, /cast\s+/i, /convert\s+/i,
  /information_schema/i, /\*/g, /;/g
];

/**
 * Returns a clean array of club names or throws an error string.
 * @param {string} raw ‚Äì raw user input from the textbox
 */
function sanitizeClubInput(raw) {
  const parts = raw.split(',').map(p => p.trim()).filter(p => p);
  const safeParts = parts.map(p => p.replace(/[^A-Za-z0-9 \-‚Äô']/g, ''));
  for (const token of safeParts) {
    for (const rgx of sqlBlacklist) {
      if (rgx.test(token)) {
        throw `‚ö†Ô∏è  The term ‚Äú${token}‚Äù looks like an SQL command and is not allowed.`;
      }
    }
  }
  return safeParts;
}

/* ==============================================================
   2Ô∏è‚É£ GLOBAL UTILITIES
   ============================================================== */

/* ----- Fisher‚ÄëYates shuffle (global) ----- */
function shuffleArray(arr) {
  // Walk the array backwards, swapping each element with a random earlier one
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;   // optional ‚Äì lets callers chain if they wish
}

/* ----- Safe‚ÄëHTML name helper (global) ----- */
function safeName(str) {
  return String(str)
    .replace(/[&<>"']/g, m => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;',
      '"': '&quot;', "'": '&#39;'
    })[m])
    .replace(/[\x00-\x1F\x7F-\x9F]/g, '')          // strip control chars
    .replace(/[\u200B-\u200F\u202A-\u202E]/g, ''); // strip invisible Unicode
}

/* ==============================================================
   3Ô∏è‚É£ PRE‚ÄëDEFINED CLUB DATABASE
   ============================================================== */
const CLUB_DATABASE = [
"Dinamo","Rijeka","Hajduk","Osijek","Istra",
"Milan","Inter","Juventus","Roma","Napoli",
"PSG","Olympique","Marseille","Monaco","Lille",
"AEK","Arsenal","Chelsea","Liverpool","Partizan",
"Real","Barcelona","Atletico","Sevilla","Valencia",
"Bayern","Borussia","RBLeipzig","Leverkus","Schalke",
"Celtic","Rangers","Aberdeen","Hearts","Hibernian",
"PAOK","Bohemians","Istra","Derry","Shelbourne",
"Wolfsburg","Fiorenti","Torino","Udinese","Sampdoria",
"Rennes","Lyon","Nice","Nantes","Toulouse","Angers",
"Everton","Fulham","Leeds","Brighton","Tottenhm","ManCity","ManUtd","Newcastle",
"Porto","Benfica","Sporting","Braga","Boavista",
"Ajax","PSV","Feyenoord","AZAlkmaar","Utrecht",
"Genk","Gent","Brugge","Anderlet","Standard",

"Croatia","France","Germany","Spain","Italy",
"England","Portugal","Netherlands","Belgium","Argentina"
];

const DEFAULT_CLUBS = [
  'LFbuyer.com','Bayern','Chelsea','PSG','ManCity','Inter'
];

const CLUBS_KEY = 'clubs';
const STATE_KEY = 'seasonState';

/* ==============================================================
   4Ô∏è‚É£ STORAGE HELPERS
   ============================================================== */
function loadClubs() {
  try {
    const arr = JSON.parse(localStorage.getItem(CLUBS_KEY));
    if (Array.isArray(arr) && arr.length >= 2) return arr.map(safeName);
  } catch {}
  return DEFAULT_CLUBS.slice();
}
function saveClubs(arr) {
  const clean = arr.map(safeName);
  localStorage.setItem(CLUBS_KEY, JSON.stringify(clean));
}
function saveState() {
  const st = { clubs, schedule, table, currentRound, sessionResults };
  localStorage.setItem(STATE_KEY, JSON.stringify(st));
}
function loadState() {
  try {
    const st = JSON.parse(localStorage.getItem(STATE_KEY));
    if (!st || !Array.isArray(st.clubs)) return false;
    clubs = st.clubs.map(safeName);
    schedule = st.schedule;
    table = st.table;
    currentRound = st.currentRound;
    sessionResults = st.sessionResults || {};
    return true;
  } catch { return false; }
}
function clearAll() {
  localStorage.removeItem(CLUBS_KEY);
  localStorage.removeItem(STATE_KEY);
  location.reload();
}

/* ==============================================================
   5Ô∏è‚É£ CORE LEAGUE LOGIC
   ============================================================== */
function generateSchedule(teams) {
  const arr = teams.length % 2 ? teams.concat([null]) : teams.slice();
  const n = arr.length, half = n / 2, rounds = n - 1;
  const out = [];
  for (let r = 0; r < rounds; r++) {
    const pairs = [];
    for (let i = 0; i < half; i++) {
      const a = arr[i], b = arr[n - 1 - i];
      if (a && b) pairs.push([a, b]);
    }
    out.push(pairs);
    arr.splice(1, 0, arr.pop()); // rotate
  }
  return out;
}
function initTable(teams) {
  const t = {};
  teams.forEach(c => {
    t[c] = { MP:0, W:0, D:0, L:0, GF:0, GA:0, PTS:0 };
  });
  return t;
}
function simulateScore() {
  return [Math.floor(Math.random()*6), Math.floor(Math.random()*6)];
}
function updateTable(t, a, b, sa, sb) {
  t[a].MP++; t[b].MP++;
  t[a].GF += sa; t[a].GA += sb;
  t[b].GF += sb; t[b].GA += sa;
  if (sa > sb) { t[a].W++; t[a].PTS+=3; t[b].L++; }
  else if (sb > sa) { t[b].W++; t[b].PTS+=3; t[a].L++; }
  else { t[a].D++; t[b].D++; t[a].PTS++; t[b].PTS++; }
}

/* ==============================================================
   6Ô∏è‚É£ RENDERING
   ============================================================== */
function renderTable() {
  const isMobile = window.matchMedia("(max-width:768px)").matches;
  const nbsp2 = "\u00A0\u00A0";  // two non-breaking spaces

  const headerRow = isMobile
    ? `<tr>
         <th>Pos &amp; Club</th>
         <th>
           M${nbsp2}W${nbsp2}D${nbsp2}L${nbsp2}PT${nbsp2}GF:GA
         </th>
       </tr>`
    : `<tr>
         <th>Pos</th><th>Club</th>
         <th>MP</th><th>W</th>
         <th>D</th><th>L</th>
         <th>PTS</th><th>GF:GA</th>
       </tr>`;

  const rows = Object.entries(table)
    .sort(([,A],[,B])=> B.PTS - A.PTS || (B.GF - B.GA) - (A.GF - A.GA))
    .map(([club,s], i) => {
      if (!isMobile) {
        return `
          <tr>
            <td>${i+1}</td>
            <td>${safeName(club)}</td>
            <td>${s.MP}</td>
            <td>${s.W}</td>
            <td>${s.D}</td>
            <td>${s.L}</td>
            <td>${s.PTS}</td>
            <td>${s.GF}:${s.GA}</td>
          </tr>`;
      } else {
        // join with TWO NBSP so they line up under header tokens
        const stats = [s.MP, s.W, s.D, s.L, s.PTS, `${s.GF}:${s.GA}`]
          .join(nbsp2);
        return `
          <tr>
            <td>${i+1} ${safeName(club)}</td>
            <td>${stats}</td>
          </tr>`;
      }
    })
    .join("");

  return `
    <div class="league-table-wrapper">
      <table class="league-table">
        ${headerRow}
        ${rows}
      </table>
    </div>`;
}


function renderSimulation() {
  const recent = [], archive = [];

  for (let r = 0; r < currentRound; r++) {
    const header = `<span class="match-line">üìÖ Round ${r+1}</span>`;
    const lines = [header];
    const shuffled = schedule[r].slice().sort(() => Math.random() - 0.5);
    shuffled.forEach(([a,b])=>{
      const line = sessionResults[`r${r}-${a}-${b}`];
      lines.push(`<span class="match-line">  ${line}</span>`);
    });
    const block = lines.join('');
    if (r===currentRound-1) recent.push(block);
    else archive.push(block);
  }

  if (currentRound < schedule.length) {
  const header = `<span class="match-line">üìÖ Round ${currentRound + 1}</span>`;
  const odds = [header];

  // üëâ Emoji you want before each odds line ‚Äì change üìä to any other you like
  const oddsEmoji = 'üìä';

  schedule[currentRound].forEach(([a, b]) => {
    const W = (Math.random() * 4 + 1).toFixed(1);
    const D = (Math.random() * 4 + 1).toFixed(1);
    const L = (Math.random() * 4 + 1).toFixed(1);

    // prepend the emoji (with a space for readability)
    odds.push(
      `<span class="match-line">  ${oddsEmoji} ${safeName(a)} vs ${safeName(b)}   W${W} D${D} L${L}</span>`
    );
  });

  recent.push(odds.join(''));
  document.querySelector('#nextBtn').disabled = false;
}
   else {
    recent.push(`<span class="match-line">üèÅ SEASON COMPLETE üèÅ</span>`);
    document.querySelector('#nextBtn').disabled = true;
  }

  document.getElementById('recentResults').innerHTML = recent.join('');
  document.getElementById('tableContainer').innerHTML = renderTable();
  document.getElementById('tableContainer').style.display = 'block';
  document.getElementById('archive').innerHTML = archive.join('');
  document.getElementById('nextBtn').style.display = 'inline-block';
}

/* ==============================================================
   7Ô∏è‚É£ INITIALISATION
   ============================================================== */
if (!loadState()) {
  clubs = loadClubs();                // saved or defaults
  schedule = generateSchedule(clubs);
  shuffleArray(schedule);             // randomise fixture order
  table = initTable(clubs);
  currentRound = 0;
  sessionResults = {};
}
renderSimulation();

/* ==============================================================
   8Ô∏è‚É£ EVENT LISTENERS
   ============================================================== */
document.getElementById('startBtn').addEventListener('click', () => {
  schedule = generateSchedule(clubs);
  shuffleArray(schedule);
  table = initTable(clubs);
  currentRound = 0;
  sessionResults = {};
  saveState();
  renderSimulation();
});

document.getElementById('nextBtn').addEventListener('click', () => {
  const roundMatches = schedule[currentRound].slice();
  roundMatches.sort(() => Math.random() - 0.5); // optional extra shuffle of match order

  roundMatches.forEach(([a,b]) => {
    const [sa,sb] = simulateScore();
    updateTable(table, a, b, sa, sb);

    const line = sa > sb
      ? `${safeName(a.toUpperCase())} üèÜ vs ${safeName(b)} ${sa}:${sb}`
      : sb > sa
      ? `${safeName(a)} vs ${safeName(b.toUpperCase())} üèÜ ${sa}:${sb}`
      : `${safeName(a)} vs ${safeName(b)} ${sa}:${sb}`;

    sessionResults[`r${currentRound}-${a}-${b}`] = line;
  });

  currentRound++;
  saveState();
  renderSimulation();
});

document.getElementById('clearBtn').addEventListener('click', clearAll);

document.getElementById('changeBtn').addEventListener('click', () => {
  const box = document.getElementById('clubChanger');
  box.style.display = box.style.display === 'none' ? 'block' : 'none';

  // ---- PICK 10 RANDOM SUGGESTIONS FROM THE DATABASE ----
  const pool = [...CLUB_DATABASE];
  const picks = [];
  for (let i = 0; i < 22 && pool.length; i++) {
    const idx = Math.floor(Math.random() * pool.length);
    picks.push(pool.splice(idx, 1)[0]);
  }
  document.getElementById('suggestions').textContent = 'Try: ' + picks.join(', ');
});

/* ==============================================================
   9Ô∏è‚É£ CLUB‚ÄëINPUT HANDLER (uses the sanitizer)
   ============================================================== */
/* -------------------------------------------------------------
   9Ô∏è‚É£ CLUB‚ÄëINPUT HANDLER (now with a 22‚Äëclub limit)
   ------------------------------------------------------------- */
document.getElementById('saveClubsBtn').addEventListener('click', () => {
  const raw = document.getElementById('clubInput').value;

  try {
    // 1Ô∏è‚É£ Clean the input (existing sanitizer)
    const clean = sanitizeClubInput(raw);

    // 2Ô∏è‚É£ Enforce the maximum‚Äëclub rule
    const MAX_CLUBS = 22;
    if (clean.length > MAX_CLUBS) {
      alert(
        `‚ùå You entered ${clean.length} clubs, but the maximum allowed is ${MAX_CLUBS}. ` +
        `Please remove ${clean.length - MAX_CLUBS} club${clean.length - MAX_CLUBS === 1 ? '' : 's'} and try again.`
      );
      return;               // stop here ‚Äì nothing gets saved
    }

    // 3Ô∏è‚É£ Still need at least two clubs to run a season
    if (clean.length < 2) {
      alert('Please enter at least two club names.');
      return;
    }

    // 4Ô∏è‚É£ Save and reload the page
    saveClubs(clean);
    alert('‚úÖ Clubs saved successfully!');
    location.reload();

  } catch (e) {
    // Sanitizer threw an error (SQL‚Äëlike token, etc.)
    alert(e);
  }
});
</script>
	<!-- 
  Copyright (c) 2025 RIOGB
  All rights reserved.
  
  This website and its content, including but not limited to text, images, and source code, 
  are protected by copyright law and may not be reproduced, distributed, or transmitted 
  in any form or by any means without the prior written permission of the copyright owner.
-->

<footer class="site-footer">
  <p>&copy; <span id="current-year"></span> RIOGB. All rights reserved.</p>
</footer>

<script>
  // Auto-update the year in the footer
  document.getElementById('current-year').textContent = new Date().getFullYear();
</script>
</body>
</html>
